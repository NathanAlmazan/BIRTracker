"use strict";(self.webpackChunkbiranila=self.webpackChunkbiranila||[]).push([[967],{93967:function(e,t,n){n.r(t),n.d(t,{default:function(){return he},formatSummaryDate:function(){return de}});var r=n(29439),a=n(72791),i=n(36314),s=n(97892),l=n.n(s),c=n(1413),o=n(45987),u=n(57621),d=n(29472),h=n(24750),f=n(71652),p=n(84639),x=n(77477),Z=n(76804),m=n(80184),v=["highlightedDays","day","outsideCurrentMonth"];function g(e){var t=e.highlightedDays,n=void 0===t?[]:t,r=e.day,a=e.outsideCurrentMonth,i=(0,o.Z)(e,v),s=!e.outsideCurrentMonth&&n.indexOf(e.day.date())>=0;return(0,m.jsx)(d.Z,{overlap:"circular",color:"error",badgeContent:s?"".concat(n.filter((function(t){return t===e.day.date()})).length):void 0,children:(0,m.jsx)(p.H,(0,c.Z)((0,c.Z)({},i),{},{outsideCurrentMonth:a,day:r}))},e.day.toString())}function b(e){var t=a.useState(!1),n=(0,r.Z)(t,2),i=n[0],s=n[1],c=a.useState(l()((new Date).toISOString())),o=(0,r.Z)(c,2),d=o[0],p=o[1],v=a.useState([]),b=(0,r.Z)(v,2),j=b[0],k=b[1];a.useEffect((function(){if(d&&e.events){s(!0);var t=e.events.filter((function(e){return"Monthly"===e.repeat||"Yearly"===e.repeat&&new Date(e.dateDue).getMonth()===d.month()})).map((function(e){return new Date(e.dateDue).getDate()}));k(t),s(!1)}}),[e.events,d]);var y=function(e){p(e)};return(0,m.jsx)(u.Z,{sx:{p:3},children:(0,m.jsx)(f._,{dateAdapter:h.y,children:(0,m.jsx)(x.W,{value:e.value,onChange:function(t){return e.onChange(t)},defaultValue:e.value,loading:i,onMonthChange:y,onYearChange:y,renderLoading:function(){return(0,m.jsx)(Z.e,{})},slots:{day:g},slotProps:{day:{highlightedDays:j}}})})})}var j=n(74165),k=n(15861),y=n(4942),S=n(9585),D=n(39504),w=n(23786),C=n(30829),I=n(12674),M=n(77196),O=n(36151),A=n(27391),N=n(68096),E=n(8399),R=n(29416),F=n(96578),Y=n(84376),q=n(71117),W={PaperProps:{style:{maxHeight:224,width:250}}};function H(e){var t=(0,F.a)(R.Qd).data,n=(0,Y.D)(q.wh),s=(0,r.Z)(n,1)[0],o=(0,Y.D)(q.vp),d=(0,r.Z)(o,1)[0],p=(0,Y.D)(q.Su),x=(0,r.Z)(p,1)[0],Z=a.useState({subject:"",description:"",recipientIds:[],type:"Report",repeat:"Monthly",dateStart:e.date?e.date.toISOString():"",dateDue:e.date?e.date.toISOString():""}),v=(0,r.Z)(Z,2),g=v[0],b=v[1],H=g.subject,L=g.description,U=g.type,P=g.repeat,T=g.dateDue,_=g.recipientIds;a.useEffect((function(){e.selected&&b({subject:e.selected.subject,description:e.selected.description,recipientIds:[],type:e.selected.type,repeat:e.selected.repeat,dateStart:new Date(e.selected.dateStart).toISOString(),dateDue:new Date(e.selected.dateDue).toISOString()})}),[e.selected]);var z=function(e){b((0,c.Z)((0,c.Z)({},g),{},(0,y.Z)({},e.target.name,e.target.value)))},B=function(){var t=(0,k.Z)((0,j.Z)().mark((function t(n){return(0,j.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),e.selected?d({variables:{scheduleId:e.selected.schedId,data:g}}).then((function(){return e.onClose()})).catch((function(e){return console.log(e)})):s({variables:{data:g}}).then((function(){return e.onClose()})).catch((function(e){return console.log(e)}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),G=function(){var t=(0,k.Z)((0,j.Z)().mark((function t(){return(0,j.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.selected&&x({variables:{scheduleId:e.selected.schedId}}).then((function(){return e.onClose()})).catch((function(e){return console.log(e)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,m.jsxs)(u.Z,{sx:{minWidth:500},children:[(0,m.jsx)(S.Z,{title:e.selected?"Update Event":"Create Event",action:(0,m.jsx)(O.Z,{variant:"contained",color:"error",onClick:e.onClose,children:"Cancel"})}),(0,m.jsx)(D.Z,{children:(0,m.jsxs)(i.Z,{spacing:2,component:"form",onSubmit:B,children:[(0,m.jsx)(A.Z,{variant:"outlined",name:"subject",label:"Subject",value:H,onChange:z,required:!0}),(0,m.jsx)(A.Z,{variant:"outlined",name:"description",label:"Description",multiline:!0,value:L,onChange:z,rows:3,required:!0}),(0,m.jsxs)(N.Z,{children:[(0,m.jsx)(C.Z,{id:"checkbox-label",children:"Concerned Officers"}),(0,m.jsx)(I.Z,{labelId:"checkbox-label",id:"multiple-checkbox",multiple:!0,value:_,onChange:function(e){var t=e.target.value;b((0,c.Z)((0,c.Z)({},g),{},{recipientIds:"string"===typeof t?t.split(","):t}))},input:(0,m.jsx)(M.Z,{label:"Concerned Officers"}),MenuProps:W,required:!0,children:t&&t.getAllRoles.filter((function(e){return![1,2,10].includes(e.roleId)})).map((function(e){return(0,m.jsx)(w.Z,{value:e.roleId,children:e.roleName},e.roleId)}))})]}),(0,m.jsx)(A.Z,{variant:"outlined",name:"type",label:"Type",value:U,onChange:z,select:!0,required:!0,children:["Report","Reminder"].map((function(e){return(0,m.jsx)(w.Z,{value:e,children:e},e)}))}),(0,m.jsx)(A.Z,{variant:"outlined",name:"repeat",label:"Repeat",value:P,onChange:z,select:!0,required:!0,children:["Monthly","Yearly"].map((function(e){return(0,m.jsx)(w.Z,{value:e,children:e},e)}))}),(0,m.jsx)(f._,{dateAdapter:h.y,children:(0,m.jsx)(E.M,{label:"Date Due",views:["year","month","day"],format:"MMMM DD, YYYY",value:l()(T),onChange:function(e){return function(e){e&&b((0,c.Z)((0,c.Z)({},g),{},{dateStart:e.toISOString(),dateDue:e.toISOString()}))}(e)}})}),(0,m.jsx)(O.Z,{type:"submit",variant:"contained",children:"Save"}),e.selected&&(0,m.jsx)(O.Z,{variant:"outlined",onClick:G,children:"Delete"})]})})]})}var L=n(20890),U=n(90493),P=n(49900),T=n(76278),_=n(13400),z=n(13967),B=n(42419),G=n(20376),Q=n(22872);function V(e){var t=(0,z.Z)(),n=(0,Q.C)((function(e){return e.auth})).role;return(0,m.jsxs)(u.Z,{children:[(0,m.jsx)(S.Z,{title:"Reports",subheader:de(e.selectedDate),action:n&&n.superuser?(0,m.jsx)(_.Z,{onClick:e.onOpen,children:(0,m.jsx)(B.Z,{})}):void 0}),(0,m.jsx)(D.Z,{children:(0,m.jsxs)(U.Z,{sx:{width:350,maxHeight:"calc(100vh - 620px)",overflowY:"auto","::-webkit-scrollbar":{height:"8px",width:"8px"},"::-webkit-scrollbar-track":{background:t.palette.grey[300]},"::-webkit-scrollbar-thumb":{background:t.palette.secondary.main},"::-webkit-scrollbar-thumb:hover":{background:t.palette.primary.dark}},children:[e.events.map((function(t){return(0,m.jsx)(T.Z,{selected:e.selected===t.schedId,onClick:function(){return e.onSelect(t.schedId)},children:(0,m.jsx)(P.Z,{primary:t.subject,secondary:t.description.slice(0,100)+"..."})},t.schedId)})),0===e.events.length&&(0,m.jsxs)(i.Z,{spacing:1,justifyContent:"center",alignItems:"center",sx:{minHeight:100},children:[(0,m.jsx)(G.Z,{sx:{width:50,height:50}}),(0,m.jsx)(L.Z,{variant:"body2",children:"No Scheduled"})]})]})})]})}var X=n(81918),J=n(94721),K=n(64554),$=n(39124),ee=n(43896),te=n(94070),ne=n(31243),re=n(85108),ae=n(70975),ie=n(62522),se=n(93044),le=function(e){return new Date(e).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})};function ce(e){var t=e.content;return(0,m.jsxs)(u.Z,{sx:{my:1},children:[(0,m.jsx)(S.Z,{avatar:(0,m.jsx)(se.Z,{children:"".concat(t.author.firstName.charAt(0)).concat(t.author.lastName.charAt(0))}),title:t.author.firstName+" "+t.author.lastName,subheader:t.author.officeSection.sectionOffice.officeName,action:(0,m.jsx)(L.Z,{variant:"body2",children:le(t.reportDate)})}),(0,m.jsxs)(D.Z,{children:[(0,m.jsx)(L.Z,{variant:"body1",color:"text.secondary",sx:{mb:3},children:t.message}),(0,m.jsx)(i.Z,{direction:"row",spacing:1,sx:{mt:2},children:t.files.map((function(e){return(0,m.jsx)(X.Z,{label:e.fileName,variant:"outlined",component:"a",href:e.fileUrl,target:"_blank",clickable:!0},e.fileId)}))})]})]})}var oe=n(86586);function ue(e){var t=(0,z.Z)(),n=(0,Y.D)(q.UN),s=(0,r.Z)(n,1)[0],l=(0,oe.t)(q.SG,{fetchPolicy:"network-only"}),c=(0,r.Z)(l,2),o=c[0],d=c[1].data,h=a.useState(0),f=(0,r.Z)(h,2),p=f[0],x=f[1],Z=(0,Q.C)((function(e){return e.auth})),v=Z.uid,g=Z.role,b=a.useState({message:"",files:[],links:[]}),y=(0,r.Z)(b,2),w=y[0],C=y[1],I=a.useState(null),M=(0,r.Z)(I,2),A=M[0],N=M[1];a.useEffect((function(){e.selectedDate&&e.event&&o({variables:{schedId:e.event.schedId,reportDate:new Date(e.selectedDate)}})}),[e.selectedDate,e.event,o]);var E=function(){var t=(0,k.Z)((0,j.Z)().mark((function t(){var n,r,a,i,l;return(0,j.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.event){t.next=2;break}return t.abrupt("return");case 2:if(0!==w.files.length||0!==w.links.length){t.next=5;break}return N("Attached file is required."),t.abrupt("return");case 5:if(n=[],r=[],!(w.files.length>0)){t.next=21;break}return a=new FormData,w.files.forEach((function(e){a.append("files",e)})),t.prev=10,t.next=13,ne.Z.post("http://trackme.nat911.com/api/upload",a);case 13:i=t.sent,n=i.data.files,t.next=21;break;case 17:return t.prev=17,t.t0=t.catch(10),N(t.t0.message),t.abrupt("return");case 21:return w.links.length>0&&(r=w.links.map((function(e){return{fileName:e.name,fileType:"url",fileUrl:e.link}}))),l=n.concat(r),t.prev=23,t.next=26,s({variables:{data:{message:w.message,files:l,authorId:v,reportDate:new Date(e.selectedDate).toISOString(),schedId:e.event.schedId}}});case 26:C({message:"",files:[],links:[]}),N(null),e.onSubmit(),t.next=35;break;case 31:return t.prev=31,t.t1=t.catch(23),N(t.t1.message),t.abrupt("return");case 35:case"end":return t.stop()}}),t,null,[[10,17],[23,31]])})));return function(){return t.apply(this,arguments)}}();return(0,m.jsx)(u.Z,{sx:{width:900},children:e.event?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(S.Z,{title:e.event.subject,subheader:de(e.selectedDate),action:g&&g.superuser?(0,m.jsx)(O.Z,{variant:"outlined",onClick:e.onEdit,children:"Edit"}):void 0}),(0,m.jsx)(D.Z,{children:(0,m.jsxs)(i.Z,{spacing:1,children:[(0,m.jsx)(i.Z,{direction:"row",spacing:1,children:e.event.recipients.map((function(e){return(0,m.jsx)(X.Z,{label:e.roleName},e.roleId)}))}),(0,m.jsx)(L.Z,{variant:"body1",sx:{pt:3},children:e.event.description}),(0,m.jsx)(J.Z,{}),(0,m.jsx)(K.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,m.jsxs)($.Z,{value:p,onChange:function(e,t){x(t)},"aria-label":"basic tabs example",children:[(0,m.jsx)(ee.Z,{label:"Submission",value:0}),(0,m.jsx)(ee.Z,{label:"Submitted Reports",value:1})]})}),0===p&&(0,m.jsxs)(i.Z,{spacing:2,children:[(0,m.jsx)(ie.Z,{userId:v,onChange:function(e){return C(e)}}),A&&(0,m.jsx)(te.Z,{color:"error",children:A}),d&&void 0!==d.getAllReports.find((function(e){return e.author.accountId===v}))&&(0,m.jsx)(te.Z,{color:"success",children:"You already submitted report for ".concat(de(e.selectedDate))}),(0,m.jsx)(O.Z,{variant:"contained",onClick:E,disabled:d&&void 0!==d.getAllReports.find((function(e){return e.author.accountId===v})),children:"Submit Report"})]}),1===p&&d&&(0,m.jsxs)(K.Z,{sx:{maxHeight:"calc(100vh - 430px)",overflowY:"auto","::-webkit-scrollbar":{height:"8px",width:"8px"},"::-webkit-scrollbar-track":{background:t.palette.grey[300]},"::-webkit-scrollbar-thumb":{background:t.palette.secondary.main},"::-webkit-scrollbar-thumb:hover":{background:t.palette.primary.dark},padding:3},children:[d.getAllReports.map((function(e){return(0,m.jsx)(ce,{content:e},e.reportId)})),0===d.getAllReports.length&&(0,m.jsxs)(i.Z,{justifyContent:"center",alignItems:"center",sx:{minHeight:300},children:[(0,m.jsx)(ae.Z,{color:"primary",sx:{width:50,height:50}}),(0,m.jsx)(L.Z,{variant:"body1",children:"No Reports Submitted"})]})]})]})})]}):(0,m.jsx)(D.Z,{children:(0,m.jsxs)(i.Z,{spacing:1,justifyContent:"center",alignItems:"center",sx:{minHeight:500},children:[(0,m.jsx)(re.Z,{sx:{width:50,height:50}}),(0,m.jsx)(L.Z,{variant:"body2",children:"No Event Selected"})]})})})}var de=function(e){return new Date(e).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})};function he(){var e=(0,Q.C)((function(e){return e.auth})).uid,t=(0,F.a)(q.rq,{variables:{userId:e}}),n=t.data,s=t.refetch,c=a.useState([]),o=(0,r.Z)(c,2),u=o[0],d=o[1],h=a.useState(l()(new Date)),f=(0,r.Z)(h,2),p=f[0],x=f[1],Z=a.useState(!1),v=(0,r.Z)(Z,2),g=v[0],j=v[1],k=a.useState(null),y=(0,r.Z)(k,2),S=y[0],D=y[1];a.useEffect((function(){p&&n&&(D(null),d(n.getAllSchedules.filter((function(e){return"Monthly"===e.repeat&&new Date(e.dateDue).getDate()===p.date()||"Yearly"===e.repeat&&new Date(e.dateDue).getMonth()===p.month()&&new Date(e.dateDue).getDate()===p.date()}))))}),[n,p]);var w=function(){j(!g),D(null),s()};return(0,m.jsxs)(i.Z,{direction:"row",spacing:2,children:[(0,m.jsxs)(i.Z,{spacing:2,children:[n&&(0,m.jsx)(b,{value:p,events:n.getAllSchedules,onChange:function(e){x(e)}}),p&&(0,m.jsx)(V,{events:u,selected:S?S.schedId:null,selectedDate:p.toISOString(),onSelect:function(e){var t=u.find((function(t){return t.schedId===e}));D(t||null)},onOpen:w})]}),g?(0,m.jsx)(H,{onClose:w,date:p,selected:S}):p&&(0,m.jsx)(ue,{selectedDate:p.toISOString(),event:S,onEdit:function(){return j(!0)},onSubmit:function(){return D(null)}})]})}},62522:function(e,t,n){n.d(t,{Z:function(){return O}});var r=n(74165),a=n(15861),i=n(93433),s=n(1413),l=n(29439),c=n(72791),o=n(64554),u=n(36314),d=n(27391),h=n(36151),f=n(13400),p=n(20068),x=n(81918),Z=n(93543),m=n(94070),v=n(15423),g=n(60103),b=n(82637),j=n(5574),k=n(97123),y=n(39157),S=n(65661),D=n(80184);function w(e){var t=c.useState(""),n=(0,l.Z)(t,2),r=n[0],a=n[1],i=c.useState(""),s=(0,l.Z)(i,2),o=s[0],u=s[1];return(0,D.jsx)(j.Z,{open:e.open,onClose:e.onClose,maxWidth:"md",children:(0,D.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.onSubmit(r,o),u("")},children:[(0,D.jsx)(S.Z,{children:"Add Link"}),(0,D.jsxs)(y.Z,{children:[(0,D.jsx)(d.Z,{autoFocus:!0,margin:"dense",name:"name",label:"File Name",fullWidth:!0,value:r,onChange:function(e){return a(e.target.value)},variant:"standard",sx:{minWidth:300},required:!0}),(0,D.jsx)(d.Z,{autoFocus:!0,margin:"dense",name:"link",label:"File Link",type:"url",fullWidth:!0,value:o,onChange:function(e){return u(e.target.value)},variant:"standard",sx:{minWidth:300},required:!0})]}),(0,D.jsxs)(k.Z,{children:[(0,D.jsx)(h.Z,{onClick:e.onClose,children:"Cancel"}),(0,D.jsx)(h.Z,{type:"submit",children:"Add Link"})]})]})})}var C=n(84376),I=n(31243),M=n(33081);function O(e){var t=e.userId,n=e.threadId,j=e.attached,k=e.onChange,y=e.onSubmit,S=(0,C.D)(M.dI),O=(0,l.Z)(S,1)[0],A=c.useState(!1),N=(0,l.Z)(A,2),E=N[0],R=N[1],F=c.useState([]),Y=(0,l.Z)(F,2),q=Y[0],W=Y[1],H=c.useState({message:"",files:[],links:[]}),L=(0,l.Z)(H,2),U=L[0],P=L[1],T=c.useState(),_=(0,l.Z)(T,2),z=_[0],B=_[1];c.useEffect((function(){var e=U.files.map((function(e){return e.name}));W(e.concat(U.links.map((function(e){return e.name}))))}),[U,k]),c.useEffect((function(){k&&k(U)}),[U,k]);var G=function(){return B(void 0)},Q=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var a,i,s,l,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(!j||0!==U.files.length||0!==U.links.length){e.next=5;break}return B("Attached file is required."),e.abrupt("return");case 5:if(a=[],i=[],!(U.files.length>0)){e.next=21;break}return s=new FormData,U.files.forEach((function(e){s.append("files",e)})),e.prev=10,e.next=13,I.Z.post("http://trackme.nat911.com/api/upload",s);case 13:l=e.sent,a=l.data.files,e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(10),B(e.t0.message),e.abrupt("return");case 21:return U.links.length>0&&(i=U.links.map((function(e){return{fileName:e.name,fileType:"url",fileUrl:e.link}}))),c=a.concat(i),e.prev=23,e.next=26,O({variables:{data:{message:U.message,files:c,senderId:t,threadId:n}}});case 26:P({message:"",files:[],links:[]}),y&&y(),e.next=34;break;case 30:return e.prev=30,e.t1=e.catch(23),B(e.t1.message),e.abrupt("return");case 34:case"end":return e.stop()}}),e,null,[[10,17],[23,30]])})));return function(){return e.apply(this,arguments)}}();return(0,D.jsxs)(o.Z,{sx:{width:"100%",backgroundColor:"#F2F3F4",position:"relative"},children:[(0,D.jsx)(d.Z,{name:"message",value:U.message,onChange:function(e){return P((0,s.Z)((0,s.Z)({},U),{},{message:e.target.value}))},multiline:!0,rows:4,fullWidth:!0}),(0,D.jsxs)(u.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{position:"absolute",bottom:0,left:0,right:0,p:1},children:[(0,D.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"row"},children:[(0,D.jsx)(p.Z,{title:"Upload File",children:(0,D.jsxs)(f.Z,{component:"label",children:[(0,D.jsx)(v.Z,{}),(0,D.jsx)("input",{type:"file",onChange:function(e){e.target.files&&P((0,s.Z)((0,s.Z)({},U),{},{files:[].concat((0,i.Z)(U.files),[e.target.files[0]])}))},hidden:!0})]})}),(0,D.jsx)(p.Z,{title:"Insert Link",children:(0,D.jsx)(f.Z,{onClick:function(){return R(!0)},children:(0,D.jsx)(g.Z,{})})}),(0,D.jsx)(o.Z,{sx:{display:"flex",flexDirection:"row",maxWidth:500,overflowX:"auto"},children:q.map((function(e){return(0,D.jsx)(x.Z,{label:e,sx:{mx:1},onDelete:function(){return function(e){var t=U.links.find((function(t){return t.name===e})),n=U.files.find((function(t){return t.name===e}));t&&P((0,s.Z)((0,s.Z)({},U),{},{links:U.links.filter((function(t){return t.name!==e}))})),n&&P((0,s.Z)((0,s.Z)({},U),{},{files:U.files.filter((function(t){return t.name!==e}))}))}(e)}},e)}))})]}),n&&(0,D.jsx)(h.Z,{variant:"contained",size:"large",endIcon:(0,D.jsx)(b.Z,{}),onClick:Q,disabled:0===U.files.length&&0===U.links.length&&0===U.message.length,children:"Reply"})]}),(0,D.jsx)(w,{open:E,onClose:function(){return R(!1)},onSubmit:function(e,t){P((0,s.Z)((0,s.Z)({},U),{},{links:[].concat((0,i.Z)(U.links),[{name:e,link:t}])})),R(!1)}}),(0,D.jsx)(Z.Z,{open:void 0!==z,autoHideDuration:6e3,onClose:G,children:(0,D.jsx)(m.Z,{onClose:G,severity:"error",sx:{width:"100%"},children:z&&z})})]})}}}]);
//# sourceMappingURL=967.c44858cd.chunk.js.map