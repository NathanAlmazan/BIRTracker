(self.webpackChunkbiranila=self.webpackChunkbiranila||[]).push([[601],{81762:function(e,t,n){"use strict";n.d(t,{Z:function(){return q}});var r=n(74165),a=n(15861),s=n(1413),i=n(29439),l=n(72791),o=n(36314),c=n(36151),d=n(13400),u=n(94721),h=n(27391),f=n(23786),x=n(81918),p=n(85523),Z=n(94454),g=n(20890),m=n(20068),j=n(25286),v=n(93543),b=n(94070),y=n(35527),I=n(64554),C=n(13967),w=n(97892),k=n.n(w),T=n(24750),S=n(71652),D=n(8399),N=n(21686),A=n(90503),R=n(96578),E=n(84376),B=n(31243),F=n(33081),L=n(62522),O=n(86569),G=n(29416),U=n(80184);function W(e,t){return e&&t?" (".concat(e,"-").concat(t,")"):e?" (".concat(e,")"):""}function q(e){var t=(0,C.Z)(),n=(0,R.a)(F.yC,{variables:{authorId:e.userId},fetchPolicy:"network-only"}).data,w=(0,R.a)(F.u3).data,q=(0,R.a)(F.Eg).data,P=(0,R.a)(F.Do).data,_=(0,R.a)(F.OG).data,z=(0,R.a)(G.Yp,{variables:{officeIds:[]}}),M=z.data,Y=z.refetch,H=(0,E.D)(F.DD),V=(0,i.Z)(H,1)[0],X=(0,E.D)(F.dI),J=(0,i.Z)(X,1)[0],K=l.useState(),Q=(0,i.Z)(K,2),$=Q[0],ee=Q[1],te=l.useState(),ne=(0,i.Z)(te,2),re=ne[0],ae=ne[1],se=l.useState(),ie=(0,i.Z)(se,2),le=ie[0],oe=ie[1],ce=l.useState(),de=(0,i.Z)(ce,2),ue=de[0],he=de[1],fe=l.useState({subject:"",authorId:e.userId,statusId:2,attachments:!0,actionable:!0,dateDue:(new Date).toISOString(),tagId:null,recipientId:[],recipientUserId:[],purposeNotes:""}),xe=(0,i.Z)(fe,2),pe=xe[0],Ze=xe[1],ge=l.useState({message:"",files:[],links:[]}),me=(0,i.Z)(ge,2),je=me[0],ve=me[1],be=l.useState(),ye=(0,i.Z)(be,2),Ie=ye[0],Ce=ye[1];if(l.useEffect((function(){if(w&&q&&P){var e={};w.getAllOfficeSections.forEach((function(t){"default"===t.sectionName?(e[t.sectionOffice.officeName+" \u2014 All"+W(t.sectionOffice.refNum,t.refNum)]=-t.sectionOffice.officeId,e[t.sectionOffice.officeName+" \u2014 Admin"+W(t.sectionOffice.refNum,t.refNum)]=t.sectionId):e[t.sectionOffice.officeName+" \u2014 "+t.sectionName+W(t.sectionOffice.refNum,t.refNum)]=t.sectionId})),ee(e);var t={};q.getAllThreadTypes.forEach((function(e){t[e.docType]=e.docId})),ae(t);var n={};P.getAllThreadPurpose.forEach((function(e){n[e.purposeName]=e.purposeId})),oe(n)}}),[w,q,P]),l.useEffect((function(){if(M){var e={};M.getAccountsByOffice.forEach((function(t){e[t.firstName+" "+t.lastName]=t.accountId})),he(e)}}),[M]),l.useEffect((function(){if(pe.docTypeId&&q){var e=q.getAllThreadTypes.find((function(e){return e.docId===pe.docTypeId}));e&&Ze((function(t){return(0,s.Z)((0,s.Z)({},t),{},{actionable:e.actionable})}))}}),[pe.docTypeId,q]),!$||!re||!le||!ue)return(0,U.jsx)(O.y,{open:!0});var we=function(){return Ce((0,s.Z)((0,s.Z)({},Ie),{},{general:void 0}))},ke=function(){var t=(0,a.Z)((0,r.Z)().mark((function t(){var n,a,i,l,o,c,d,u;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(pe.recipientId){t.next=3;break}return Ce((0,s.Z)((0,s.Z)({},Ie),{},{recipient:"Recipient is required."})),t.abrupt("return");case 3:if(pe.purposeId){t.next=6;break}return Ce((0,s.Z)((0,s.Z)({},Ie),{},{purpose:"Purpose is required."})),t.abrupt("return");case 6:if(pe.docTypeId){t.next=9;break}return Ce((0,s.Z)((0,s.Z)({},Ie),{},{type:"Type is required."})),t.abrupt("return");case 9:if(0!==pe.subject.length){t.next=12;break}return Ce((0,s.Z)((0,s.Z)({},Ie),{},{recipient:"Subject is required."})),t.abrupt("return");case 12:return t.prev=12,t.next=15,V({variables:{data:pe}});case 15:if((n=t.sent).data){t.next=19;break}return Ce((0,s.Z)((0,s.Z)({},Ie),{},{general:"Failed to create thread."})),t.abrupt("return");case 19:if(a=[],i=[],!(je.files.length>0)){t.next=35;break}return l=new FormData,je.files.forEach((function(e){l.append("files",e)})),t.prev=24,t.next=27,B.Z.post("https://rr6manila.com/api/upload",l);case 27:o=t.sent,a=o.data.files,t.next=35;break;case 31:return t.prev=31,t.t0=t.catch(24),Ce((0,s.Z)((0,s.Z)({},Ie),{},{general:t.t0.message})),t.abrupt("return");case 35:je.links.length>0&&(i=je.links.map((function(e){return{fileName:e.name,fileType:"url",fileUrl:e.link}}))),c=a.concat(i),t.prev=37,d=0;case 39:if(!(d<n.data.createThread.length)){t.next=46;break}return u=n.data.createThread[d],t.next=43,J({variables:{data:{message:je.message,files:c,senderId:e.userId,threadId:u.refId}}});case 43:d++,t.next=39;break;case 46:e.onCreateThread(n.data.createThread[0].refId),t.next=53;break;case 49:return t.prev=49,t.t1=t.catch(37),Ce((0,s.Z)((0,s.Z)({},Ie),{},{general:t.t1.message})),t.abrupt("return");case 53:t.next=59;break;case 55:return t.prev=55,t.t2=t.catch(12),Ce((0,s.Z)((0,s.Z)({},Ie),{},{general:t.t2.message})),t.abrupt("return");case 59:case"end":return t.stop()}}),t,null,[[12,55],[24,31],[37,49]])})));return function(){return t.apply(this,arguments)}}();return(0,U.jsx)(y.Z,{sx:{width:"100%"},children:(0,U.jsx)(I.Z,{sx:{width:"100%",maxHeight:"calc(100vh - 105px)",overflowY:"auto",overflowX:"hidden","::-webkit-scrollbar":{height:"8px",width:"8px"},"::-webkit-scrollbar-track":{background:t.palette.grey[300]},"::-webkit-scrollbar-thumb":{background:t.palette.secondary.main},"::-webkit-scrollbar-thumb:hover":{background:t.palette.primary.dark}},children:(0,U.jsxs)(o.Z,{spacing:3,sx:{p:2},children:[(0,U.jsxs)("div",{children:[(0,U.jsxs)(o.Z,{direction:"row",justifyContent:"space-between",alignItems:"end",children:[(0,U.jsxs)(o.Z,{direction:"row",spacing:1,alignItems:"center",sx:{py:1},children:[(0,U.jsx)(c.Z,{variant:"contained",endIcon:(0,U.jsx)(N.Z,{}),onClick:ke,children:"Send"}),(0,U.jsx)(m.Z,{title:"Discard",children:(0,U.jsx)(d.Z,{onClick:e.onDiscardThread,children:(0,U.jsx)(A.Z,{})})})]}),n&&(0,U.jsx)(g.Z,{variant:"body2",sx:{fontWeight:800},children:"".concat(n.getThreadRefNum)})]}),(0,U.jsx)(u.Z,{})]}),(0,U.jsxs)(o.Z,{direction:"row",spacing:2,children:[(0,U.jsx)(x.Z,{label:"To",variant:"outlined",sx:{width:80}}),(0,U.jsx)(j.Z,{multiple:!0,freeSolo:!0,fullWidth:!0,options:Object.keys($),onChange:function(e,t){Ze((0,s.Z)((0,s.Z)({},pe),{},{recipientId:t.map((function(e){return $[e]}))})),Y({officeIds:t.map((function(e){return $[e]})).filter((function(e){return e>0}))})},renderInput:function(e){return(0,U.jsx)(h.Z,(0,s.Z)((0,s.Z)({},e),{},{variant:"standard",error:void 0!==(null===Ie||void 0===Ie?void 0:Ie.recipient),helperText:Ie&&Ie.recipient}))}})]}),(0,U.jsxs)(o.Z,{direction:"row",spacing:2,children:[(0,U.jsx)(x.Z,{label:"Officers",variant:"outlined",sx:{width:80}}),(0,U.jsx)(j.Z,{multiple:!0,freeSolo:!0,fullWidth:!0,options:Object.keys(ue),onChange:function(e,t){Ze((0,s.Z)((0,s.Z)({},pe),{},{recipientUserId:t.map((function(e){return ue[e]}))}))},renderInput:function(e){return(0,U.jsx)(h.Z,(0,s.Z)((0,s.Z)({},e),{},{variant:"standard"}))}})]}),(0,U.jsxs)(o.Z,{direction:"row",spacing:2,children:[(0,U.jsx)(x.Z,{label:"Subject",variant:"outlined",sx:{width:80}}),(0,U.jsx)(h.Z,{name:"subject",variant:"standard",value:pe.subject,onChange:function(e){return Ze((0,s.Z)((0,s.Z)({},pe),{},{subject:e.target.value}))},fullWidth:!0,error:void 0!==(null===Ie||void 0===Ie?void 0:Ie.subject),helperText:Ie&&Ie.subject})]}),(0,U.jsxs)(o.Z,{direction:"row",spacing:2,children:[(0,U.jsx)(x.Z,{label:"Purpose",variant:"outlined",sx:{width:80}}),(0,U.jsx)(j.Z,{freeSolo:!0,fullWidth:!0,onInputChange:function(e,t){return Ze((0,s.Z)((0,s.Z)({},pe),{},{purposeNotes:t}))},onChange:function(e,t){return Ze((0,s.Z)((0,s.Z)({},pe),{},{purposeId:le[t]}))},options:Object.keys(le),renderInput:function(e){return(0,U.jsx)(h.Z,(0,s.Z)((0,s.Z)({},e),{},{variant:"standard",error:void 0!==(null===Ie||void 0===Ie?void 0:Ie.purpose),helperText:Ie&&Ie.purpose}))}})]}),(0,U.jsxs)(o.Z,{direction:"row",spacing:2,children:[(0,U.jsx)(x.Z,{label:"Type",variant:"outlined",sx:{width:80}}),(0,U.jsx)(j.Z,{freeSolo:!0,fullWidth:!0,onChange:function(e,t){return Ze((0,s.Z)((0,s.Z)({},pe),{},{docTypeId:re[t]}))},options:Object.keys(re),renderInput:function(e){return(0,U.jsx)(h.Z,(0,s.Z)((0,s.Z)({},e),{},{variant:"standard",error:void 0!==(null===Ie||void 0===Ie?void 0:Ie.type),helperText:Ie&&Ie.type}))}})]}),(0,U.jsxs)(o.Z,{direction:"row",spacing:2,children:[(0,U.jsx)(x.Z,{label:"Tag",variant:"outlined",sx:{width:80}}),(0,U.jsxs)(h.Z,{fullWidth:!0,name:"tagId",variant:"standard",select:!0,value:pe.tagId?pe.tagId:0,onChange:function(e){var t=parseInt(e.target.value,10);Ze(0===t?(0,s.Z)((0,s.Z)({},pe),{},{tagId:null}):(0,s.Z)((0,s.Z)({},pe),{},{tagId:t}))},children:[(0,U.jsx)(f.Z,{value:0,children:"None"}),_&&_.getAllThreadTags.map((function(e){return(0,U.jsx)(f.Z,{value:e.tagId,children:e.tagName},e.tagId)}))]})]}),(0,U.jsx)(S._,{dateAdapter:T.y,children:(0,U.jsx)(D.M,{label:"Date Due",views:["year","month","day"],value:k()(pe.dateDue),onChange:function(e){e&&Ze((0,s.Z)((0,s.Z)({},pe),{},{dateDue:e.toISOString()}))},format:"MMMM DD, YYYY"})}),(0,U.jsxs)(o.Z,{direction:"row",spacing:2,children:[(0,U.jsx)(p.Z,{control:(0,U.jsx)(Z.Z,{checked:pe.attachments,onChange:function(e){return Ze((0,s.Z)((0,s.Z)({},pe),{},{attachments:e.target.checked}))}}),label:"Attachments Required?"}),(0,U.jsx)(p.Z,{control:(0,U.jsx)(Z.Z,{checked:pe.actionable,onChange:function(e){return Ze((0,s.Z)((0,s.Z)({},pe),{},{actionable:e.target.checked}))}}),label:"Action Required?"})]}),(0,U.jsx)(L.Z,{userId:e.userId,onChange:function(e){return ve(e)}}),(0,U.jsx)(v.Z,{open:void 0!==(null===Ie||void 0===Ie?void 0:Ie.general),autoHideDuration:6e3,onClose:we,children:(0,U.jsx)(b.Z,{onClose:we,severity:"error",sx:{width:"100%"},children:Ie&&Ie.general})})]})})})}},56908:function(e,t,n){"use strict";n.d(t,{Z:function(){return q}});var r=n(29439),a=n(72791),s=n(90493),i=n(36314),l=n(81918),o=n(76278),c=n(94721),d=n(49900),u=n(20653),h=n(93044),f=n(20890),x=n(36151),p=n(13400),Z=n(35527),g=n(64554),m=n(63033),j=n(13967),v=n(43950),b=n(42419),y=n(70975),I=n(1413),C=n(12065),w=n(61419),k=n(10765),T=n(85523),S=n(68096),D=n(17133),N=n(9953),A=n(91903),R=n(90544),E=n(96578),B=n(33081),F=n(80184);function L(e){var t=e.options,n=e.onChange,s=(0,E.a)(B.Eg).data,l=(0,E.a)(B.Ph).data,o=(0,E.a)(B.OG).data,c=(0,a.useState)(!1),d=(0,r.Z)(c,2),u=d[0],h=d[1],f=function(e){return h(!u)};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(p.Z,{onClick:f,sx:(0,I.Z)({p:0,mx:2},u&&{"&:before":{zIndex:1,content:"''",width:"100%",height:"100%",borderRadius:"50%",position:"absolute",bgcolor:function(e){return(0,C.Fq)(e.palette.grey[900],.8)}}}),children:(0,F.jsx)(A.Z,{})}),(0,F.jsx)(N.ZP,{anchor:"right",open:u,onClose:f,children:(0,F.jsxs)(i.Z,{spacing:2,sx:{py:10,px:3,minWidth:300},children:[(0,F.jsx)(i.Z,{direction:"row",justifyContent:"flex-end",children:(0,F.jsx)(x.Z,{variant:"outlined",startIcon:(0,F.jsx)(R.Z,{}),onClick:function(){n({typeId:0,statusId:0,tagId:0,sortBy:"due_desc"})},children:"Clear Filters"})}),(0,F.jsxs)(S.Z,{children:[(0,F.jsx)(D.Z,{children:"Filter by Status"}),(0,F.jsxs)(k.Z,{value:t.statusId,onChange:function(e){return n((0,I.Z)((0,I.Z)({},t),{},{statusId:parseInt(e.target.value)}))},children:[(0,F.jsx)(T.Z,{value:0,control:(0,F.jsx)(w.Z,{}),label:"None"}),l&&l.getAllThreadStatus.map((function(e){return(0,F.jsx)(T.Z,{value:e.statusId,control:(0,F.jsx)(w.Z,{}),label:e.statusLabel},e.statusId)}))]})]}),(0,F.jsxs)(S.Z,{children:[(0,F.jsx)(D.Z,{children:"Filter by Tags"}),(0,F.jsxs)(k.Z,{value:t.tagId,onChange:function(e){return n((0,I.Z)((0,I.Z)({},t),{},{tagId:parseInt(e.target.value)}))},children:[(0,F.jsx)(T.Z,{value:0,control:(0,F.jsx)(w.Z,{}),label:"None"}),o&&o.getAllThreadTags.map((function(e){return(0,F.jsx)(T.Z,{value:e.tagId,control:(0,F.jsx)(w.Z,{}),label:e.tagName},e.tagId)}))]})]}),(0,F.jsxs)(S.Z,{children:[(0,F.jsx)(D.Z,{children:"Filter by Document Type"}),(0,F.jsxs)(k.Z,{value:t.typeId,onChange:function(e){return n((0,I.Z)((0,I.Z)({},t),{},{typeId:parseInt(e.target.value)}))},children:[(0,F.jsx)(T.Z,{value:0,control:(0,F.jsx)(w.Z,{}),label:"None"}),s&&s.getAllThreadTypes.map((function(e){return(0,F.jsx)(T.Z,{value:e.docId,control:(0,F.jsx)(w.Z,{}),label:e.docType},e.docId)}))]})]}),(0,F.jsxs)(S.Z,{children:[(0,F.jsx)(D.Z,{children:"Sort By"}),(0,F.jsxs)(k.Z,{value:t.sortBy,onChange:function(e){return n((0,I.Z)((0,I.Z)({},t),{},{sortBy:e.target.value}))},children:[(0,F.jsx)(T.Z,{value:"crt_asc",control:(0,F.jsx)(w.Z,{}),label:"Date Created Ascending"}),(0,F.jsx)(T.Z,{value:"crt_desc",control:(0,F.jsx)(w.Z,{}),label:"Date Created Descending"}),(0,F.jsx)(T.Z,{value:"due_asc",control:(0,F.jsx)(w.Z,{}),label:"Date Due Ascending"}),(0,F.jsx)(T.Z,{value:"due_desc",control:(0,F.jsx)(w.Z,{}),label:"Date Due Descending"})]})]})]})})]})}var O=n(86569),G={inbox:{title:"Job Well Done!",sub:"You have no active threads"},sent:{title:"Compose a thread",sub:"You have no created threads"}},U=function(e){return"Top Priority"===e?"error":"Confidential"===e?"warning":"primary"},W=function(e){return new Date(e).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})};function q(e){var t=(0,j.Z)(),n=a.useState(0),I=(0,r.Z)(n,2),C=I[0],w=I[1],k=a.useState(10),T=(0,r.Z)(k,2),S=T[0],D=T[1],N=a.useState({typeId:0,statusId:0,tagId:0,sortBy:"due_desc"}),A=(0,r.Z)(N,2),R=A[0],E=A[1],B=a.useMemo((function(){var t;return null===(t=e.mails)||void 0===t?void 0:t.filter((function(e){var t;return(e.status.statusId===R.statusId||0===R.statusId)&&(e.docType.docId===R.typeId||0===R.typeId)&&((null===(t=e.threadTag)||void 0===t?void 0:t.tagId)===R.tagId||0===R.tagId)})).sort((function(e,t){switch(R.sortBy){case"crt_asc":return new Date(e.dateCreated).getTime()-new Date(t.dateCreated).getTime();case"crt_desc":return new Date(t.dateCreated).getTime()-new Date(e.dateCreated).getTime();case"due_asc":return new Date(e.dateDue).getTime()-new Date(t.dateDue).getTime();default:return new Date(t.dateDue).getTime()-new Date(e.dateDue).getTime()}})).slice(C*S,C*S+S)}),[e.mails,R,C,S]);return(0,F.jsxs)(a.Fragment,{children:[(0,F.jsx)(O.y,{open:void 0===e.mails}),(0,F.jsxs)(i.Z,{direction:"row",spacing:2,alignItems:"center",sx:{mb:3},children:["completed"!==e.mode&&(0,F.jsx)(x.Z,{variant:"contained",endIcon:(0,F.jsx)(b.Z,{}),disabled:e.compose,onClick:e.onComposeThread,children:"Compose"}),(0,F.jsx)(p.Z,{onClick:e.onRefresh,children:(0,F.jsx)(v.Z,{})}),(0,F.jsx)(L,{options:R,onChange:function(e){return E(e)}})]}),(0,F.jsxs)(Z.Z,{sx:{width:"100%"},children:[(0,F.jsxs)(s.Z,{sx:{width:"100%",maxHeight:"calc(100vh - 220px)",overflowY:"auto","::-webkit-scrollbar":{height:"8px",width:"8px"},"::-webkit-scrollbar-track":{background:t.palette.grey[300]},"::-webkit-scrollbar-thumb":{background:t.palette.secondary.main},"::-webkit-scrollbar-thumb:hover":{background:t.palette.primary.dark}},children:[e.mails&&0===e.mails.length&&(0,F.jsxs)(g.Z,{sx:{display:"flex",height:300,justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,F.jsx)(y.Z,{color:"secondary",sx:{fontSize:64,mb:1}}),(0,F.jsx)(f.Z,{variant:"subtitle1",children:G[e.mode].title}),(0,F.jsx)(f.Z,{variant:"body1",children:G[e.mode].sub})]}),B&&B.map((function(t){return(0,F.jsxs)(a.Fragment,{children:[(0,F.jsxs)(o.Z,{selected:Boolean(e.selectedId)&&t.refId===e.selectedId,alignItems:"flex-start",onClick:function(){return e.onThreadClick(t.refId)},children:[(0,F.jsx)(u.Z,{children:(0,F.jsx)(h.Z,{children:"".concat(t.author.firstName.charAt(0)).concat(t.author.lastName.charAt(0))})}),(0,F.jsx)(d.Z,{primary:(0,F.jsxs)(g.Z,{sx:{mb:2},children:[(0,F.jsx)(f.Z,{variant:"body1",gutterBottom:!0,children:t.subject}),(0,F.jsxs)("div",{children:[(0,F.jsx)(f.Z,{sx:{display:"inline"},component:"span",variant:"subtitle2",color:"text.primary",children:"regionInbox"===e.mode?t.recipient.sectionOffice.officeName:"".concat(t.author.firstName," ").concat(t.author.lastName)})," \u2014 ".concat(t.docType.docType," request For ").concat(t.purpose.purposeName,".")]})]}),secondary:(0,F.jsxs)(g.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,F.jsxs)("div",{children:[(0,F.jsx)(l.Z,{color:t.completed?"success":"info",label:t.status.statusLabel,size:"small",sx:{fontSize:10}}),t.threadTag&&(0,F.jsx)(l.Z,{color:U(t.threadTag.tagName),label:t.threadTag.tagName,size:"small",sx:{fontSize:10}})]}),(0,F.jsx)(f.Z,{variant:"caption",children:"Due at ".concat(W(t.dateDue))})]})})]}),(0,F.jsx)(c.Z,{variant:"inset",component:"li"})]},t.refId)}))]}),(0,F.jsx)(m.Z,{rowsPerPageOptions:[10,20,30],component:"div",count:e.mails?e.mails.filter((function(e){var t;return(e.status.statusId===R.statusId||0===R.statusId)&&(e.docType.docId===R.typeId||0===R.typeId)&&((null===(t=e.threadTag)||void 0===t?void 0:t.tagId)===R.tagId||0===R.tagId)})).length:0,rowsPerPage:S,page:C,onPageChange:function(e,t){w(t)},onRowsPerPageChange:function(e){D(parseInt(e.target.value,10)),w(0)}})]})]})}},62522:function(e,t,n){"use strict";n.d(t,{Z:function(){return N}});var r=n(74165),a=n(15861),s=n(93433),i=n(1413),l=n(29439),o=n(72791),c=n(64554),d=n(36314),u=n(27391),h=n(36151),f=n(13400),x=n(20068),p=n(81918),Z=n(93543),g=n(94070),m=n(15423),j=n(60103),v=n(82637),b=n(5574),y=n(97123),I=n(39157),C=n(65661),w=n(80184);function k(e){var t=o.useState(""),n=(0,l.Z)(t,2),r=n[0],a=n[1],s=o.useState(""),i=(0,l.Z)(s,2),c=i[0],d=i[1];return(0,w.jsx)(b.Z,{open:e.open,onClose:e.onClose,maxWidth:"md",children:(0,w.jsxs)("form",{onSubmit:function(t){t.preventDefault(),e.onSubmit(r,c),d("")},children:[(0,w.jsx)(C.Z,{children:"Add Link"}),(0,w.jsxs)(I.Z,{children:[(0,w.jsx)(u.Z,{autoFocus:!0,margin:"dense",name:"name",label:"File Name",fullWidth:!0,value:r,onChange:function(e){return a(e.target.value)},variant:"standard",sx:{minWidth:300},required:!0}),(0,w.jsx)(u.Z,{autoFocus:!0,margin:"dense",name:"link",label:"File Link",type:"url",fullWidth:!0,value:c,onChange:function(e){return d(e.target.value)},variant:"standard",sx:{minWidth:300},required:!0})]}),(0,w.jsxs)(y.Z,{children:[(0,w.jsx)(h.Z,{onClick:e.onClose,children:"Cancel"}),(0,w.jsx)(h.Z,{type:"submit",children:"Add Link"})]})]})})}var T=n(84376),S=n(31243),D=n(33081);function N(e){var t=e.userId,n=e.threadId,b=e.attached,y=e.onChange,I=e.onSubmit,C=(0,T.D)(D.dI),N=(0,l.Z)(C,1)[0],A=o.useState(!1),R=(0,l.Z)(A,2),E=R[0],B=R[1],F=o.useState([]),L=(0,l.Z)(F,2),O=L[0],G=L[1],U=o.useState({message:"",files:[],links:[]}),W=(0,l.Z)(U,2),q=W[0],P=W[1],_=o.useState(),z=(0,l.Z)(_,2),M=z[0],Y=z[1];o.useEffect((function(){var e=q.files.map((function(e){return e.name}));G(e.concat(q.links.map((function(e){return e.name}))))}),[q,y]),o.useEffect((function(){y&&y(q)}),[q,y]);var H=function(){return Y(void 0)},V=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var a,s,i,l,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(!b||0!==q.files.length||0!==q.links.length){e.next=5;break}return Y("Attached file is required."),e.abrupt("return");case 5:if(a=[],s=[],!(q.files.length>0)){e.next=21;break}return i=new FormData,q.files.forEach((function(e){i.append("files",e)})),e.prev=10,e.next=13,S.Z.post("https://rr6manila.com/api/upload",i);case 13:l=e.sent,a=l.data.files,e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(10),Y(e.t0.message),e.abrupt("return");case 21:return q.links.length>0&&(s=q.links.map((function(e){return{fileName:e.name,fileType:"url",fileUrl:e.link}}))),o=a.concat(s),e.prev=23,e.next=26,N({variables:{data:{message:q.message,files:o,senderId:t,threadId:n}}});case 26:P({message:"",files:[],links:[]}),I&&I(),e.next=34;break;case 30:return e.prev=30,e.t1=e.catch(23),Y(e.t1.message),e.abrupt("return");case 34:case"end":return e.stop()}}),e,null,[[10,17],[23,30]])})));return function(){return e.apply(this,arguments)}}();return(0,w.jsxs)(c.Z,{sx:{width:"100%",backgroundColor:"#F2F3F4",position:"relative"},children:[(0,w.jsx)(u.Z,{name:"message",value:q.message,onChange:function(e){return P((0,i.Z)((0,i.Z)({},q),{},{message:e.target.value}))},multiline:!0,rows:4,fullWidth:!0}),(0,w.jsxs)(d.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{position:"absolute",bottom:0,left:0,right:0,p:1},children:[(0,w.jsxs)(c.Z,{sx:{display:"flex",flexDirection:"row"},children:[(0,w.jsx)(x.Z,{title:"Upload File",children:(0,w.jsxs)(f.Z,{component:"label",children:[(0,w.jsx)(m.Z,{}),(0,w.jsx)("input",{type:"file",onChange:function(e){e.target.files&&P((0,i.Z)((0,i.Z)({},q),{},{files:[].concat((0,s.Z)(q.files),[e.target.files[0]])}))},hidden:!0})]})}),(0,w.jsx)(x.Z,{title:"Insert Link",children:(0,w.jsx)(f.Z,{onClick:function(){return B(!0)},children:(0,w.jsx)(j.Z,{})})}),(0,w.jsx)(c.Z,{sx:{display:"flex",flexDirection:"row",maxWidth:500,overflowX:"auto"},children:O.map((function(e){return(0,w.jsx)(p.Z,{label:e,sx:{mx:1},onDelete:function(){return function(e){var t=q.links.find((function(t){return t.name===e})),n=q.files.find((function(t){return t.name===e}));t&&P((0,i.Z)((0,i.Z)({},q),{},{links:q.links.filter((function(t){return t.name!==e}))})),n&&P((0,i.Z)((0,i.Z)({},q),{},{files:q.files.filter((function(t){return t.name!==e}))}))}(e)}},e)}))})]}),n&&(0,w.jsx)(h.Z,{variant:"contained",size:"large",endIcon:(0,w.jsx)(v.Z,{}),onClick:V,disabled:0===q.files.length&&0===q.links.length&&0===q.message.length,children:"Reply"})]}),(0,w.jsx)(k,{open:E,onClose:function(){return B(!1)},onSubmit:function(e,t){P((0,i.Z)((0,i.Z)({},q),{},{links:[].concat((0,s.Z)(q.links),[{name:e,link:t}])})),B(!1)}}),(0,w.jsx)(Z.Z,{open:void 0!==M,autoHideDuration:6e3,onClose:H,children:(0,w.jsx)(g.Z,{onClose:H,severity:"error",sx:{width:"100%"},children:M&&M})})]})}},75324:function(e,t,n){"use strict";n.d(t,{Z:function(){return ve}});var r=n(74165),a=n(15861),s=n(29439),i=n(72791),l=n(36314),o=n(64554),c=n(20890),d=n(27391),u=n(23786),h=n(94721),f=n(56125),x=n(13400),p=n(35527),Z=n(36151),g=n(94070),m=n(39124),j=n(43896),v=n(13967),b=n(46557),y=n(29823),I=n(43950),C=n(86569),w=n(57621),k=n(9585),T=n(39504),S=n(93044),D=n(81918),N=n(80184),A=function(e){return new Date(e).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})};function R(e){var t=e.content;return e.sender?(0,N.jsxs)(w.Z,{children:[(0,N.jsx)(k.Z,{avatar:(0,N.jsx)(S.Z,{sx:{backgroundColor:"red"},children:"".concat(t.sender.firstName.charAt(0)).concat(t.sender.lastName.charAt(0))}),title:t.sender.firstName+" "+t.sender.lastName,subheader:t.sender.role.roleName,action:(0,N.jsx)(c.Z,{variant:"body2",children:A(t.dateSent)})}),(0,N.jsxs)(T.Z,{children:[(0,N.jsx)(c.Z,{variant:"body1",color:"text.secondary",sx:{mb:3},children:t.message}),(0,N.jsx)(l.Z,{direction:"row",spacing:1,sx:{mt:2},children:t.files.map((function(e){return(0,N.jsx)(D.Z,{label:e.fileName,variant:"outlined",component:"a",href:e.fileUrl,target:"_blank",clickable:!0},e.fileId)}))})]})]}):(0,N.jsxs)(o.Z,{sx:{border:"1px solid #989898",borderRadius:3},children:[(0,N.jsx)(k.Z,{avatar:(0,N.jsx)(S.Z,{children:"".concat(t.sender.firstName.charAt(0)).concat(t.sender.lastName.charAt(0))}),title:t.sender.firstName+" "+t.sender.lastName,subheader:t.sender.role.roleName,action:(0,N.jsx)(c.Z,{variant:"body2",children:A(t.dateSent)})}),(0,N.jsxs)(T.Z,{children:[(0,N.jsx)(c.Z,{variant:"body1",color:"text.secondary",sx:{mb:3},children:t.message}),(0,N.jsx)(l.Z,{direction:"row",spacing:1,sx:{mt:2},children:t.files.map((function(e){return(0,N.jsx)(D.Z,{label:e.fileName,variant:"outlined",component:"a",href:e.fileUrl,target:"_blank",clickable:!0},e.fileId)}))})]})]})}var E=n(4942),B=n(1413),F=n(25286),L=n(93543),O=n(97892),G=n.n(O),U=n(24750),W=n(71652),q=n(8399),P=n(53329),_=n(5574),z=n(65661),M=n(39157),Y=n(97123),H=n(51276),V=n.n(H),X=n(31243);function J(e){var t=e.open,n=(e.imageUrl,e.onSubmit),l=e.onClose,o=i.useRef(null),c=i.useState(null),d=(0,s.Z)(c,2),u=d[0],h=d[1],f=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var a,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target.files){e.next=15;break}return(a=new FormData).append("files",t.target.files[0]),e.prev=3,e.next=6,X.Z.post("https://rr6manila.com/api/upload",a);case 6:s=e.sent,n(s.data.files[0].fileUrl),l(),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(3),h(e.t0.message),e.abrupt("return");case 15:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}();return(0,N.jsxs)(_.Z,{open:t,onClose:l,maxWidth:"md",children:[(0,N.jsx)(z.Z,{children:"Add Signature"}),(0,N.jsxs)(M.Z,{children:[u&&(0,N.jsx)(g.Z,{severity:"error",children:u}),(0,N.jsx)(V(),{penColor:"black",ref:o,canvasProps:{width:500,height:200}})]}),(0,N.jsxs)(Y.Z,{children:[(0,N.jsxs)(Z.Z,{component:"label",children:["Upload Signature",(0,N.jsx)("input",{type:"file",onChange:f,hidden:!0})]}),(0,N.jsx)(Z.Z,{onClick:function(){o.current&&(n(o.current.getTrimmedCanvas().toDataURL("image/png")),l())},children:"Submit Signature"}),(0,N.jsx)(Z.Z,{color:"error",onClick:function(){o.current&&(o.current.clear(),l())},children:"Cancel"})]})]})}var K=n(74815),Q=function(e){return new Date(e).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})},$=function(e){return"default"===e.sectionName?e.sectionOffice.officeName:"".concat(e.sectionName," (").concat(e.sectionOffice.refNum,")")};function ee(e){var t=e.thread,n=e.details;return(0,N.jsx)(K.BB,{children:(0,N.jsxs)(K.T3,{size:"A4",style:te.body,children:[(0,N.jsx)(K.G7,{style:te.table,children:(0,N.jsxs)(K.G7,{style:te.tableRow,children:[(0,N.jsxs)(K.G7,{style:te.tableColLeft,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:"BIR"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:"FORM 2309"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:"(REVISED OCTOBER, 1971)"})]}),(0,N.jsxs)(K.G7,{style:te.tableColRight,children:[(0,N.jsx)(K.xv,{style:te.tableCellRight,children:"BUREAU OF INTERNAL REVENUE"}),(0,N.jsx)(K.xv,{style:te.tableCellRight,children:"Revenue Region No. 6 - Manila"}),(0,N.jsx)(K.xv,{style:te.tableCellRight,children:"REFERENCE SLIP # ".concat(t.refSlipNum)}),(0,N.jsx)(K.xv,{style:te.tableCellTag,children:t.threadTag?t.threadTag.tagName.toUpperCase():""})]})]})}),(0,N.jsx)(K.G7,{style:te.table,children:(0,N.jsxs)(K.G7,{style:te.tableRow,children:[(0,N.jsxs)(K.G7,{style:te.recipientCol,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:"TO:"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:t.recipientList.map((function(e){return $(e)})).join(", ")})]}),(0,N.jsxs)(K.G7,{style:te.dateCol,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:"DATE:"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:Q(t.dateCreated)})]})]})}),(0,N.jsx)(K.G7,{style:te.table,children:(0,N.jsx)(K.G7,{style:te.tableRow,children:(0,N.jsxs)(K.G7,{style:te.purposeCol,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:"SUBJECT:"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:n.subject})]})})}),(0,N.jsx)(K.G7,{style:te.table,children:(0,N.jsxs)(K.G7,{style:te.tableRow,children:[(0,N.jsxs)(K.G7,{style:te.recipientCol,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:"FOR:"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:t.purposeNotes?t.purposeNotes:t.purpose.purposeName})]}),(0,N.jsxs)(K.G7,{style:te.dateCol,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:"DEADLINE:"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:Q(t.dateDue)})]})]})}),(0,N.jsx)(K.G7,{style:te.table,children:(0,N.jsx)(K.G7,{style:te.tableRow,children:(0,N.jsxs)(K.G7,{style:te.purposeCol,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:"REMARKS (or additional instructions):"}),(0,N.jsx)(K.xv,{style:te.tableCellLeft,children:n.remarks})]})})}),(0,N.jsx)(K.G7,{style:te.table,children:(0,N.jsxs)(K.G7,{style:te.tableRow,children:[(0,N.jsxs)(K.G7,{style:te.recipientCol,children:[(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:"FROM:"}),n.signatureUrl?(0,N.jsx)(K.G7,{style:te.signatureContainer,children:(0,N.jsx)(K.Ee,{style:te.signatureImage,src:n.signatureUrl})}):t.author.signImage?(0,N.jsx)(K.G7,{style:te.signatureContainer,children:(0,N.jsx)(K.Ee,{style:te.signatureImage,src:t.author.signImage})}):(0,N.jsx)(K.xv,{style:te.emptyCell}),(0,N.jsx)(K.xv,{style:te.tableCellCenter,children:t.author.firstName+" "+t.author.lastName}),(0,N.jsx)(K.xv,{style:te.tableCellCenterSmall,children:t.author.role.roleName}),(0,N.jsx)(K.xv,{style:te.tableCellCenterSmall,children:t.author.officeSection.sectionOffice.officeName})]}),(0,N.jsx)(K.G7,{style:te.dateCol,children:(0,N.jsx)(K.xv,{style:te.tableCellLeftBold,children:t.author.officeSection.sectionOffice.refNum})})]})}),(0,N.jsx)(K.G7,{style:te.table,children:(0,N.jsx)(K.G7,{style:te.tableRow,children:(0,N.jsx)(K.G7,{style:te.purposeCol,children:(0,N.jsx)(K.xv,{style:te.tableCellLeftBoldSmall,children:"NOTE: This slip must be filled with the papers to which it is attached."})})})})]})})}K.Zx.register({family:"Oswald",src:"https://fonts.gstatic.com/s/oswald/v13/Y_TKV6o8WovbUd3m_X9aAA.ttf"});var te=K.mM.create({body:{paddingTop:15,paddingBottom:15,paddingRight:"50%",paddingLeft:15},table:{width:"auto",borderStyle:"solid",borderWidth:1,padding:2},tableRow:{margin:"auto",marginTop:2,flexDirection:"row"},tableColRight:{width:"60%"},tableColLeft:{width:"40%"},recipientCol:{width:"70%"},dateCol:{width:"30%"},purposeCol:{width:"100%"},tableCellLeft:{margin:2,fontSize:9,textAlign:"left"},emptyCell:{height:30},tableCellLeftBold:{margin:2,fontSize:9,textAlign:"left",fontWeight:"bold"},tableCellLeftBoldSmall:{margin:2,fontSize:6,textAlign:"left",fontWeight:"bold"},tableCellRight:{margin:2,fontSize:9,textAlign:"right"},tableCellTag:{margin:2,fontSize:9,textAlign:"right",color:"red"},tableCellCenter:{margin:2,fontSize:8,textAlign:"center"},tableCellCenterSmall:{margin:2,fontSize:8,textAlign:"center"},signatureContainer:{display:"flex",flexDirection:"row",justifyContent:"center"},signatureImage:{width:60,height:30}}),ne=n(96578),re=n(84376),ae=n(29416),se=n(33081);function ie(e){var t=e.userId,n=e.thread,o=e.onGenerate,c=(0,ne.a)(se.Eg).data,h=(0,ne.a)(se.Do).data,f=(0,ne.a)(se.OG).data,x=(0,re.D)(ae.sz),p=(0,s.Z)(x,2),m=p[0],j=p[1].error,v=(0,re.D)(se.B5),b=(0,s.Z)(v,2),y=b[0],I=b[1].error,w=i.useState({subject:"",remarks:"",signatureUrl:null}),k=(0,s.Z)(w,2),T=k[0],S=k[1],A=i.useState({subject:n.subject,dateDue:new Date(n.dateDue).toISOString(),tagId:n.threadTag?n.threadTag.tagId:null,purposeNotes:n.purposeNotes?n.purposeNotes:"",docTypeId:n.docType.docId,purposeId:n.purpose.purposeId}),R=(0,s.Z)(A,2),O=R[0],_=R[1],z=i.useState(),M=(0,s.Z)(z,2),Y=M[0],H=M[1],V=i.useState(),Q=(0,s.Z)(V,2),$=Q[0],te=Q[1],ie=i.useState(null),le=(0,s.Z)(ie,2),oe=le[0],ce=le[1],de=i.useState(!1),ue=(0,s.Z)(de,2),he=ue[0],fe=ue[1],xe=i.useState(!1),pe=(0,s.Z)(xe,2),Ze=pe[0],ge=pe[1];if(i.useEffect((function(){if(c&&h){var e={};c.getAllThreadTypes.forEach((function(t){e[t.docType]=t.docId})),H(e);var t={};h.getAllThreadPurpose.forEach((function(e){t[e.purposeName]=e.purposeId})),te(t)}}),[c,h]),i.useEffect((function(){S((function(e){return(0,B.Z)((0,B.Z)({},e),{},{subject:n.subject,remarks:n.messages[0].message})}))}),[n]),i.useEffect((function(){var e=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!oe){e.next=17;break}return(t=new FormData).append("form",oe),t.append("requestId",n.refId),e.prev=4,e.next=7,X.Z.post("https://rr6manila.com/api/requestForm",t);case 7:a=e.sent,window.open(a.data.fileUrl,"_blank"),o(),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(4),console.log(e.t0),e.abrupt("return");case 16:ce(null);case 17:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(){return e.apply(this,arguments)}}();e()}),[oe,o,n.refId]),i.useEffect((function(){_((function(e){return(0,B.Z)((0,B.Z)({},e),{},{subject:T.subject})}))}),[T.subject]),!Y||!$)return(0,N.jsx)(C.y,{open:!0});var me=function(e){S((0,B.Z)((0,B.Z)({},T),{},(0,E.Z)({},e.target.name,e.target.value)))},je=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,a){var s,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||!t){e.next=16;break}return window.open(a,"_blank"),s=new File([t],"".concat(n.refSlipNum,".pdf"),{type:"application/pdf"}),(i=new FormData).append("form",s),i.append("requestId",n.refId),e.prev=6,e.next=9,X.Z.post("https://rr6manila.com/api/requestForm",i);case 9:o(),e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(6),console.log(e.t0),e.abrupt("return");case 16:case"end":return e.stop()}}),e,null,[[6,12]])})));return function(t,n){return e.apply(this,arguments)}}(),ve=function(){return fe(!he)},be=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S((0,B.Z)((0,B.Z)({},T),{},{signatureUrl:n})),e.next=3,m({variables:{userId:t,signImage:n}});case 3:ge(!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S((0,B.Z)((0,B.Z)({},T),{},{signatureUrl:null})),e.next=3,m({variables:{userId:t,signImage:null}});case 3:ge(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y({variables:{data:(0,B.Z)((0,B.Z)({},O),{},{refNum:n.refSlipNum})}});case 2:o(),ge(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,N.jsxs)(l.Z,{spacing:3,sx:{p:2},children:[(0,N.jsxs)(l.Z,{direction:"row",spacing:1,justifyContent:"flex-end",alignItems:"center",children:[(0,N.jsx)(Z.Z,{variant:"contained",startIcon:(0,N.jsx)(P.Z,{}),onClick:Ie,children:"Save Changes"}),(0,N.jsx)(Z.Z,{variant:"outlined",onClick:ve,children:"Add Signature"}),n.author.signImage&&(0,N.jsx)(Z.Z,{variant:"outlined",color:"error",onClick:ye,children:"Remove Signature"})]}),(0,N.jsxs)(l.Z,{direction:"row",spacing:2,children:[(0,N.jsx)(D.Z,{label:"Subject",variant:"outlined",sx:{width:80}}),(0,N.jsx)(d.Z,{multiline:!0,fullWidth:!0,variant:"standard",name:"subject",value:T.subject,onChange:me})]}),(0,N.jsxs)(l.Z,{direction:"row",spacing:2,children:[(0,N.jsx)(D.Z,{label:"Purpose",variant:"outlined",sx:{width:80}}),(0,N.jsx)(F.Z,{freeSolo:!0,fullWidth:!0,defaultValue:n.purpose.purposeName,onInputChange:function(e,t){return _((0,B.Z)((0,B.Z)({},O),{},{purposeNotes:t}))},onChange:function(e,t){return _((0,B.Z)((0,B.Z)({},O),{},{purposeId:$[t]}))},options:Object.keys($),renderInput:function(e){return(0,N.jsx)(d.Z,(0,B.Z)((0,B.Z)({},e),{},{variant:"standard"}))}})]}),(0,N.jsxs)(l.Z,{direction:"row",spacing:2,children:[(0,N.jsx)(D.Z,{label:"Type",variant:"outlined",sx:{width:80}}),(0,N.jsx)(F.Z,{freeSolo:!0,fullWidth:!0,defaultValue:n.docType.docType,onChange:function(e,t){return _((0,B.Z)((0,B.Z)({},O),{},{docTypeId:Y[t]}))},options:Object.keys(Y),renderInput:function(e){return(0,N.jsx)(d.Z,(0,B.Z)((0,B.Z)({},e),{},{variant:"standard"}))}})]}),(0,N.jsxs)(l.Z,{direction:"row",spacing:2,children:[(0,N.jsx)(D.Z,{label:"Tag",variant:"outlined",sx:{width:80}}),(0,N.jsxs)(d.Z,{fullWidth:!0,name:"tagId",variant:"standard",select:!0,value:O.tagId?O.tagId:0,onChange:function(e){var t=parseInt(e.target.value,10);_(0===t?(0,B.Z)((0,B.Z)({},O),{},{tagId:null}):(0,B.Z)((0,B.Z)({},O),{},{tagId:t}))},children:[(0,N.jsx)(u.Z,{value:0,children:"None"}),f&&f.getAllThreadTags.map((function(e){return(0,N.jsx)(u.Z,{value:e.tagId,children:e.tagName},e.tagId)}))]})]}),(0,N.jsxs)(l.Z,{direction:"row",spacing:2,children:[(0,N.jsx)(D.Z,{label:"Remarks",variant:"outlined",sx:{width:80}}),(0,N.jsx)(d.Z,{multiline:!0,fullWidth:!0,variant:"standard",name:"remarks",value:T.remarks,onChange:me})]}),(0,N.jsx)(W._,{dateAdapter:U.y,children:(0,N.jsx)(q.M,{label:"Date Due",views:["year","month","day"],value:G()(O.dateDue),onChange:function(e){e&&_((0,B.Z)((0,B.Z)({},O),{},{dateDue:e.toISOString()}))},format:"MMMM DD, YYYY"})}),(0,N.jsx)(K.WD,{document:(0,N.jsx)(ee,{thread:n,details:T}),fileName:"".concat(n.subject,".pdf"),children:function(e){var t=e.blob,n=e.url;e.loading,e.error;return(0,N.jsx)(Z.Z,{fullWidth:!0,onClick:function(){return je(t,n)},variant:"contained",children:"Generate Form 2309"})}}),(0,N.jsxs)(Z.Z,{fullWidth:!0,disabled:null!==oe,component:"label",variant:"outlined",children:["Upload Form 2309",(0,N.jsx)("input",{type:"file",hidden:!0,onChange:function(e){e.target.files&&ce(e.target.files[0])}})]}),(0,N.jsx)(J,{open:he,imageUrl:T.signatureUrl,onSubmit:be,onClose:ve}),(0,N.jsx)(L.Z,{open:Ze,autoHideDuration:6e3,onClose:function(){return ge(!1)},children:(0,N.jsx)(g.Z,{onClose:function(){return ge(!1)},severity:I||j?"error":"success",sx:{width:"100%"},children:I||j?"Failed to save changes.":"Saved changes successfully!"})})]})}var le=n(62522),oe=n(90493),ce=n(15021),de=n(49900),ue=n(57064),he=n(53717),fe=n(50533);function xe(e){var t=i.useState([]),n=(0,s.Z)(t,2),r=n[0],a=n[1];return i.useEffect((function(){var t=[];e.messages.forEach((function(e){t=t.concat(e.files)})),a(t)}),[e.messages]),(0,N.jsxs)(o.Z,{sx:{width:"100%",p:2},children:[(0,N.jsx)(c.Z,{sx:{mt:4,mb:2},variant:"h6",component:"div",children:"Shared Files"}),(0,N.jsxs)(oe.Z,{children:[e.reqForm&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(ce.ZP,{children:[(0,N.jsx)(ue.Z,{children:(0,N.jsx)(he.Z,{})}),(0,N.jsx)(de.Z,{primary:(0,N.jsx)(c.Z,{component:fe.Z,variant:"body1",href:e.reqForm,target:"_blank",children:"Form 2309"}),secondary:"application/PDF"})]}),(0,N.jsx)(h.Z,{})]}),r.map((function(e){return(0,N.jsxs)(i.Fragment,{children:[(0,N.jsxs)(ce.ZP,{children:[(0,N.jsx)(ue.Z,{children:(0,N.jsx)(he.Z,{})}),(0,N.jsx)(de.Z,{primary:(0,N.jsx)(c.Z,{component:fe.Z,variant:"body1",href:e.fileUrl,target:"_blank",children:e.fileName}),secondary:e.fileType})]}),(0,N.jsx)(h.Z,{})]},e.fileId)}))]})]})}var pe=function(e){return new Date(e).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})};function Ze(e){return(0,N.jsxs)(o.Z,{sx:{width:"100%",p:2},children:[(0,N.jsx)(c.Z,{sx:{mt:4,mb:2},variant:"h6",component:"div",children:"Request History"}),(0,N.jsx)(l.Z,{spacing:2,children:e.history.map((function(e,t){return(0,N.jsx)(g.Z,{severity:(n=e.status?e.status.statusLabel:null,n&&n.includes("Closed")?"success":n&&n.includes("Progress")?"info":n&&n.includes("Approval")?"warning":"info"),children:"".concat(e.historyLabel," ").concat(e.status?"to ".concat(e.status.statusLabel):""," at ").concat(pe(e.dateCreated))},t);var n}))})]})}var ge=n(45450);function me(e){return(0,N.jsx)("div",{children:e.value===e.index&&e.children})}var je=function(e){return new Date(e).toLocaleDateString(void 0,{weekday:"short",year:"numeric",month:"short",day:"numeric"})};function ve(e){var t=e.userId,n=e.threadId,w=e.onUpdate,k=(0,v.Z)(),T=(0,ne.a)(se.l5,{variables:{uid:n}}),S=T.data,D=T.loading,A=T.refetch,E=(0,ge.m)(se.DT,{variables:{threadId:n}}).data,B=(0,ne.a)(se.Ph).data,F=(0,re.D)(se.IJ),L=(0,s.Z)(F,1)[0],O=(0,re.D)(se.By),G=(0,s.Z)(O,1)[0],U=(0,re.D)(se.p5),W=(0,s.Z)(U,1)[0],q=(0,re.D)(se.l8),P=(0,s.Z)(q,1)[0],_=i.useState(0),z=(0,s.Z)(_,2),M=z[0],Y=z[1],H=i.useState(!1),V=(0,s.Z)(H,2),X=V[0],J=V[1],K=i.useState(2),Q=(0,s.Z)(K,2),$=Q[0],ee=Q[1],te=i.useState("true"),ae=(0,s.Z)(te,2),oe=ae[0],ce=ae[1],de=i.useState(!1),ue=(0,s.Z)(de,2),he=ue[0],fe=ue[1];i.useEffect((function(){E&&A({uid:E.liveThread.referenceNum})}),[E,A]),i.useEffect((function(){S&&(ee(S.getThreadById.status.statusId),ce(S.getThreadById.attachments?"true":"false"),fe(S.getThreadById.completed))}),[S]),i.useEffect((function(){S&&S.getThreadById.messages.filter((function(e){return e.sender.accountId!==t})).forEach((function(e){G({variables:{threadId:S.getThreadById.refId,userId:e.sender.accountId}})}))}),[S,t,G]),i.useEffect((function(){A({uid:n}),Y(0)}),[n,A]);var pe=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L({variables:{uid:n,attachments:"true"===oe,statusId:parseInt(t.target.value)}});case 2:fe([1,3].includes(parseInt(t.target.value))),ee(parseInt(t.target.value)),Ie();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L({variables:{uid:n,attachments:"true"===t.target.value,statusId:$}});case 2:ce(t.target.value);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W({variables:{threadId:n}});case 2:Ie();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P({variables:{threadId:n}});case 2:Ie();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){A({uid:n}),w()};if(D||!S||!B)return(0,N.jsx)(C.y,{open:!0});var Ce=S.getThreadById,we=Ce.subject,ke=Ce.author,Te=Ce.refSlipNum,Se=Ce.dateDue,De=Ce.messages,Ne=Ce.recipient,Ae=Ce.dateUpdated,Re=Ce.dateCreated,Ee=Ce.status,Be=Ce.attachments,Fe=Ce.active,Le=Ce.recipientUser;return(0,N.jsx)(p.Z,{sx:{width:"100%"},children:(0,N.jsxs)(o.Z,{sx:{width:"100%",maxHeight:"calc(100vh - 105px)",overflowY:"auto",overflowX:"hidden","::-webkit-scrollbar":{height:"8px",width:"8px"},"::-webkit-scrollbar-track":{background:k.palette.grey[300]},"::-webkit-scrollbar-thumb":{background:k.palette.secondary.main},"::-webkit-scrollbar-thumb:hover":{background:k.palette.primary.dark}},children:[(0,N.jsxs)(o.Z,{sx:{width:"100%",p:2},children:[(0,N.jsxs)(l.Z,{direction:"row",spacing:1,justifyContent:"space-between",alignItems:"center",children:[(0,N.jsx)(c.Z,{variant:"body2",sx:{fontWeight:800},children:"Ref # ".concat(Te)}),(0,N.jsxs)(o.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,N.jsx)(c.Z,{variant:"body2",children:"From ".concat(je(Re)," to ").concat(je(Se))}),(t===S.getThreadById.author.accountId&&!S.getThreadById.purpose.purposeName.includes("Approval")||t!==S.getThreadById.author.accountId&&S.getThreadById.purpose.purposeName.includes("Approval"))&&(0,N.jsx)(x.Z,{onClick:function(){return J(!X)},children:X?(0,N.jsx)(y.Z,{}):(0,N.jsx)(b.Z,{})}),(0,N.jsx)(x.Z,{onClick:Ie,children:(0,N.jsx)(I.Z,{})})]})]}),(0,N.jsx)(f.Z,{in:X,timeout:"auto",unmountOnExit:!0,children:(0,N.jsxs)(l.Z,{direction:"row",spacing:2,justifyContent:"flex-end",sx:{my:2},children:[(0,N.jsx)(d.Z,{name:"status",label:"Status",select:!0,sx:{width:200},value:$,onChange:pe,children:B.getAllThreadStatus.map((function(e){return(0,N.jsx)(u.Z,{value:e.statusId,children:e.statusLabel},e.statusId)}))}),(0,N.jsxs)(d.Z,{name:"attachments",label:"Attachments",select:!0,sx:{width:200},value:oe,onChange:ve,children:[(0,N.jsx)(u.Z,{value:"true",children:"Required"}),(0,N.jsx)(u.Z,{value:"false",children:"Not Required"})]})]})}),(0,N.jsx)(h.Z,{sx:{mb:1}}),Fe?(0,N.jsx)(g.Z,{severity:he?"success":"info",action:t===S.getThreadById.author.accountId&&(0,N.jsx)(Z.Z,{color:"error",onClick:be,children:"Cancel"}),children:he?"This thread is complied and closed at ".concat(je(Ae),"."):Ee.statusLabel}):(0,N.jsx)(g.Z,{severity:"error",action:t===S.getThreadById.author.accountId&&(0,N.jsx)(Z.Z,{onClick:ye,children:"Restore"}),children:"Archived Request"})]}),(0,N.jsxs)(o.Z,{sx:{px:2},children:[(0,N.jsxs)(c.Z,{variant:"body1",color:"secondary",children:[ke.firstName+" "+ke.lastName,(0,N.jsx)("span",{style:{color:"black"},children:" to "}),Le?"".concat(Le.firstName," ").concat(Le.lastName," (").concat(Ne.sectionOffice.refNum,")"):"".concat(Ne.sectionOffice.officeName," ").concat("default"===Ne.sectionName?"":" \u2014 ".concat(Ne.sectionName))]}),(0,N.jsx)(c.Z,{variant:"h4",children:we})]}),(0,N.jsxs)(m.Z,{value:M,onChange:function(e,t){return Y(t)},sx:{mt:2},children:[(0,N.jsx)(j.Z,{value:0,label:"Conversation"}),S.getThreadById.author.accountId===t&&(0,N.jsx)(j.Z,{value:1,label:"Details"}),(0,N.jsx)(j.Z,{value:2,label:"Files"}),(0,N.jsx)(j.Z,{value:3,label:"History"})]}),(0,N.jsxs)(me,{index:0,value:M,children:[(0,N.jsx)(o.Z,{sx:{p:2},children:De.map((function(e){return(0,N.jsx)(o.Z,{sx:{my:2,pl:e.sender.accountId===t?8:0,pr:e.sender.accountId!==t?8:0},children:(0,N.jsx)(R,{content:e,sender:e.sender.accountId===t})},e.msgId)}))}),(0,N.jsx)(o.Z,{sx:{p:2},children:!he&&(0,N.jsx)(le.Z,{userId:t,threadId:n,attached:Be,onSubmit:Ie})})]}),S.getThreadById.author.accountId===t&&(0,N.jsx)(me,{index:1,value:M,children:(0,N.jsx)(ie,{userId:t,thread:S.getThreadById,onGenerate:Ie})}),(0,N.jsx)(me,{index:2,value:M,children:(0,N.jsx)(xe,{messages:S.getThreadById.messages,reqForm:S.getThreadById.reqForm})}),(0,N.jsx)(me,{index:3,value:M,children:(0,N.jsx)(Ze,{history:S.getThreadById.history})})]})})}},42480:function(){}}]);
//# sourceMappingURL=601.f0e3500b.chunk.js.map